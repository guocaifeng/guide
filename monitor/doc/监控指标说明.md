# 1 主机监控
## 1.1 load指标
### 1.1.1 介绍
```text
系统负载（System Load）是系统CPU繁忙程度的度量，即有多少进程在等待被CPU调度（进程等待队列的长度）。  
平均负载（Load Average）是一段时间内系统的平均负载，这个一段时间一般取1分钟、5分钟、15分钟。  
```
### 1.1.2 查看命令
```text
$ uptime    
13:53:39 up 130 days,  2:15,  1 user,  load average: 1.58, 2.58, 5.58
```
### 1.1.2 load数值含义
```text
把CPU比喻成一条（单核）马路，进程任务比喻成马路上跑着的汽车，Load则表示马路的繁忙程度：
(1)load<1 完全不拥挤
[A   A   A   A   A   A   A]
(2)load=1 已经满了
[AAAAAAAAAAAAAAAAAAAAAAAAA]
(3)Load>1：拥堵了，需要排队
AAAAA -->  [AAAAAAAAAAAAAAAAAAAAAAAAA]
(4)多核CPU
AAAAA -->  [AAAAAAAAAAAAAAAAAAAAAAAAA]
AAAAA -->  [AAAAAAAAAAAAAAAAAAAAAAAAA]
```
### 1.1.3 load推荐值
```text
Load<0.7     系统很闲，马路上没什么车，要考虑多部署一些服务    
0.7<Load<1   系统状态不错，马路可以轻松应对    
Load==1      系统马上要处理不多来了，赶紧找一下原因    
Load>5       马路已经非常繁忙了，进入马路的每辆汽车都要无法很快的运行   
```

### 1.1.4 load值查看分析
```text
结合具体情况具体分析：     
1）1分钟Load>5，5分钟Load<1，15分钟Load<1：短期内繁忙，中长期空闲，初步判断是一个“抖动”，或者是“拥塞前兆”  
2）1分钟Load>5，5分钟Load>1，15分钟Load<1：短期内繁忙，中期内紧张，很可能是一个“拥塞的开始”  
3）1分钟Load>5，5分钟Load>5，15分钟Load>5：短中长期都繁忙，系统“正在拥塞”   
4）1分钟Load<1，5分钟Load>1，15分钟Load>5：短期内空闲，中长期繁忙，不用紧张，系统“拥塞正在好转”    
```
## 1.2 CPU
### 1.2.1 CPU分配
```text
user   	 从系统启动开始累计到当前时刻，处于用户态的运行时间，不包含 nice值为负进程。
nice   	 从系统启动开始累计到当前时刻，nice值为负的进程所占用的CPU时间
system 	 从系统启动开始累计到当前时刻，处于核心态的运行时间
idle   	 从系统启动开始累计到当前时刻，除IO等待时间以外的其它等待时间
iowait 	 从系统启动开始累计到当前时刻，IO等待时间
irq 	 从系统启动开始累计到当前时刻，硬中断时间
softirq  从系统启动开始累计到当前时刻，软中断时间
```
## 1.3 网络
### 1.3.1 pps
```text
是指网络吞吐率
pps是包转发率单位，表示包/秒，交换机每秒可以转发多少百万个数据包（Mpps），即交换机能同时转发的数据包的数量。
```
## 1.4 磁盘
### 1.4.1 iops
```text
IOPS (Input/Output Per Second)即每秒的输入输出量(或读写次数)，是衡量磁盘性能的主要指标之一。
IOPS是指单位时间内系统能处理的I/O请求数量，一般以每秒处理的I/O请求数量为单位，I/O请求通常为读或写数据操作请求。

随机读写频繁的应用，如小文件存储(图片)、OLTP数据库、邮件服务器，关注随机读写性能，IOPS是关键衡量指标。
顺序读写频繁的应用，传输大量连续数据，如电视台的视频编辑，视频点播VOD(Video On Demand)，关注连续读写性能。数据吞吐量是关键衡量指标。

（1）常见磁盘平均物理寻道时间为：
7200转/分的STAT硬盘平均物理寻道时间是9ms
10000转/分的STAT硬盘平均物理寻道时间是6ms
15000转/分的SAS硬盘平均物理寻道时间是4ms
（2）常见硬盘的旋转延迟时间为：
7200 rpm的磁盘平均旋转延迟大约为60*1000/7200/2 = 4.17ms
10000 rpm的磁盘平均旋转延迟大约为60*1000/10000/2 = 3ms，
15000 rpm的磁盘其平均旋转延迟约为60*1000/15000/2 = 2ms。
（3）最大IOPS的理论计算方法
IOPS = 1000 ms/ (寻道时间 + 旋转延迟)。可以忽略数据传输时间。
7200 rpm的磁盘IOPS = 1000 / (9 + 4.17) = 76 IOPS
10000 rpm的磁盘IOPS = 1000 / (6+ 3) = 111 IOPS
15000 rpm的磁盘IOPS = 1000 / (4 + 2) = 166 IOPS

```
### 1.4.2 file Descriptor
```text
FileDescriptor是"文件描述符".
内核（kernel）利用文件描述符（file descriptor）来访问文件。文件描述符是非负整数。
打开现存文件或新建文件时，内核会返回一个文件描述符。读写文件也需要使用文件描述符来指定待读写的文件。

在编写文件操作的或者网络通信的软件时，初学者一般可能会遇到“Too many open files”的问题。
这主要是因为文件描述符是系统的一个重要资源，虽然说系统内存有多少就可以打开多少的文件描述符，
但是在实际实现过程中内核是会做相应的处理的，一般最大打开文件数会是系统内存的10%（以KB来计算）（称之为系统级限制），
查看系统级别的最大打开文件数可以使用sysctl -a | grep fs.file-max命令查看。
与此同时，内核为了不让某一个进程消耗掉所有的文件资源，其也会对单个进程最大打开文件数做默认值处理（称之为用户级限制），
默认值一般是1024，使用ulimit -n命令可以查看。
```
### 1.4.3 time读写 ms
```text
每个磁盘分区读花费的毫秒数
每个磁盘分区写花费的毫秒数
```


# 2 容器监控
## 2.1 CPU
### 2.1.1 CPU使用率
```text
目前部署未使用资源限制功能，所以每一个容器能占用的cpu资源数值是动态变化的，
所以CPU使用率是相对于当前占用到的CPU，在这个基础上的一个使用百分比。
```